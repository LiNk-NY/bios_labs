---
title: "Mediation Analysis"
author: "BIOS 620"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Setup

```{r}
library(mediation)
data(iris)
df <- iris
```

First, let's simulate the mediator, "attractiveness to the bee." This variable
will be named mediator and - for our example - will consist of two parts. 35%
of its value is Sepal.Length + 65% of its value is random noise.


```{r}
set.seed(12334)
df$random1 <- runif(nrow(df), min = min(df$Sepal.Length),
    max = max(df$Sepal.Length) )
df$random2 <- runif(nrow(df), min = min(df$Petal.Width),
    max = max(df$Petal.Width))
```

```{r}
df$mediator <- df$Sepal.Length * 0.25 +  df$random1 * 0.5 + df$random2 * 0.25
```

simulate the dependent variable, "likelihood to be pollinated by a bee." This
variable will be named dv and consists of two parts again. 35% of its value is
the Mediator, + 65% of its value is random noise.
In our example, the random noise could be non-plant-specific attributes like
the location of the flower, weather conditions, soil, etc.

```{r}
df$random3 <- runif(nrow(df), min = min(df$mediator), max = max(df$mediator))
```

```{r}
df$dv      <- df$mediator * 0.4 +  df$random3 * 0.5 + df$random2 * 0.1
```

# Without Petal.Width

## Step 1

```{r}
fit.totaleffect <- lm(dv ~ Sepal.Length, df)
summary(fit.totaleffect)
```

## Step 2

```{r}
fit.mediator <- lm(mediator ~ Sepal.Length, df)
summary(fit.mediator)
```

## Step 3

```{r}
fit.dv <- lm(dv ~ Sepal.Length + mediator, df)
summary(fit.dv)
```

## Step 4

```{r}
results1 <- mediate(fit.mediator, fit.dv, treat='Sepal.Length',
    mediator='mediator',  boot=TRUE)
```

## With Petal.Width

## Step-1

```{r}
fit.totaleffect <- lm(dv ~ Sepal.Length + Petal.Width, df)
summary(fit.totaleffect)
```

## Step 2

```{r}
fit.mediator <- lm(mediator ~ Sepal.Length + Petal.Width, df)
summary(fit.mediator)
```

## Step 3

```{r}
fit.dv <- lm(dv ~ Sepal.Length + mediator + Petal.Width, df)
summary(fit.dv)
```

## Step 4

```{r}
results2 <- mediate(fit.mediator, fit.dv, treat='Sepal.Length',
    mediator='mediator', boot=TRUE)
```

## compare results

```{r}
summary(results1)
summary(results2)
```

