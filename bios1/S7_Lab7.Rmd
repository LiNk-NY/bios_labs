---
title: "RCT / Review Session"
author: "BIOS 620"
date: "3/18/2021"
output:
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Faraway Dataset

```{r}
library(faraway)
data(penicillin)
```

# Sidenote: Reshaping data (wide format)

```{r}
library(tidyr)
pivot_wider(penicillin, names_from = "treat", values_from = "yield")
```


## Penicillin yield based on blend and processes

```{r}
g <- lm(yield ~ treat+blend, data=penicillin)
```

```{r}
summary(g)
```

Here we fit the models that we will use to compare to the full (leave the
main effect variable out)

```{r}
fit0 <- lm(yield ~ treat, data = penicillin)
fit1 <- lm(yield ~ blend, data = penicillin)
```

Is the main effect of blend significant? 

```{r}
anova(g, fit0)
```

Is the main effect of treatment significant? 

```{r}
anova(g, fit1)
```

## Exploratory Data Analysis and Diagnostic Plots

```{r}
par(mfrow=c(2,2))
boxplot(yield~treat, data= penicillin, las=1)
boxplot(yield~blend, data= penicillin, las=1)
plot(predict(g), resid(g), xlab="Fitted", ylab="Residuals", las=1)
abline(h=0, lty=2)
qqnorm(resid(g), las=1)
qqline(resid(g), col=2)
```

# Visualizing contrasts

```{r}
suppressPackageStartupMessages(library(PairViz))
g2 <-  aov(yield ~ treat + blend, data= penicillin)
tuk <- TukeyHSD(g2,conf.level = 0.95)
par(mfrow=c(1,2))
par(mar=c(5,6,4,2))
plot(tuk, las=1, tcl = -.3)
```

# Review

```{r}
data(mtcars)
```

```{r}
fit <- lm(mpg ~ wt, data = mtcars)
```

## Using the regression equation with new data

For example, we want to predict the `mpg` for a car that weighs 4000 lbs.

```{r}
predict(fit, newdata = data.frame(wt = 4))
```

```{r}
coefs <- unname(coef(fit))
intercept <- coefs[1]
betawt <- coefs[2]
intercept + (betawt*4)
```

## With multiple linear regresion

```{r}
library(haven)
nhanes <- read_spss("data/NHANES_Lab4.sav")
```

### create our factor

```{r}
edu_levels <- attributes(nhanes$Education)$labels
nhanes$Education_f <- factor(nhanes$Education,
    levels = edu_levels, labels = names(edu_levels))
table(nhanes$Education_f)
```

```{r}
fit <- lm(BPXSY1 ~ Education_f + Male + Exactage, data = nhanes)
```

## Create a small data.frame with new data

```{r}
predict(fit,
    data.frame(Exactage = 30, Education_f = "Graduated from College", Male = 0)
)
```


